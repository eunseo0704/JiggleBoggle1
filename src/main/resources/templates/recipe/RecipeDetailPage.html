<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" th:href="@{/css/style.css}" />
    <link rel="stylesheet" th:href="@{/css/RecipeWrite.css}" />

    <title>JiggleBoggle</title>
</head>
<body>
<form id="mainForm" name="mainForm" method="post" th:action="@{/saveRecipeData}"  th:object="${recipe}" enctype="multipart/form-data">

    <div th:unless="${isLoggedIn}" th:insert="fragments/header :: site-header"></div>
    <div th:if="${isLoggedIn}" th:insert="fragments/header :: jb-site-header"></div>

    <div class="recipe-container">

        <!-- ì™„ì„± ì‚¬ì§„ ì—¬ëŸ¬ ì¥ -->
        <label>ì™„ì„± ì‚¬ì§„ ğŸ“¸</label>
        <div id="mainPreviewArea" class="multi-preview-area" >
            <span th:each="img : ${imgList}">
                <img th:src="${img.imagePath}" class="multi-preview-image">
            </span>
        </div>

        <label for="title">ë ˆì‹œí”¼ ì œëª©</label>
        <input type="text" id= "title"  name="title"  th:value="${recipe.title}"  readonly class="input_style wd100">

        <label>ë ˆì‹œí”¼ ì†Œê°œ ğŸ½ï¸</label>
        <textarea id="rcpDisc" name="rcpDisc"  th:text="${recipe.rcpDisc}"  readonly rows="6"></textarea>

        <!-- ğŸ§¾ ì¹´í…Œê³ ë¦¬ / ë‚œì´ë„ / ìš”ë¦¬ì‹œê°„ -->
        <div class="form-section">
            <div class="info-row">
                <!-- ì¹´í…Œê³ ë¦¬ -->
                <div class="info-item">
                    <label for="categoryId">ì¹´í…Œê³ ë¦¬</label>
                    <select id="categoryId" name="categoryId" disabled>
                        <option value="">ì„ íƒ</option>
                        <option th:each="cat : ${categoryList}" th:value="${cat.code}" th:text="${cat.codeName}" th:selected="${recipe.categoryId == cat.code}"></option>
                    </select>
                </div>
                <!-- ë‚œì´ë„ -->
                <div class="info-item">
                    <label for="cookDfct">ë‚œì´ë„</label>
                    <select id="cookDfct" name="cookDfct" disabled>
                        <option value="">ì„ íƒ</option>
                        <option th:each="cat : ${cookDfctList}" th:value="${cat.code}" th:text="${cat.codeName}" th:selected="${recipe.cookDfct == cat.code}"></option>
                    </select>
                </div>
                <!-- ìš”ë¦¬ì‹œê°„ -->
                <div class="info-item">
                    <label for="cookTime">ìš”ë¦¬ ì‹œê°„</label>
                    <select id="cookTime" name="cookTime" disabled>
                        <option value="">ì„ íƒ</option>
                        <option th:each="cat : ${cooktimeList}" th:value="${cat.code}" th:text="${cat.codeName}" th:selected="${recipe.cookTime== cat.code}"></option>
                    </select>
                </div>
            </div>
        </div>

        <label>íƒœê·¸ #ï¸âƒ£</label>
        <input type="text" id="tagName" name="tagName"  th:value="${recipe.tagName}" readonly class="input_style wd100">

        <table id="ingredientTable" class="ingredient-table">
            <thead>
            <tr>
                <th>ì¬ë£Œëª…</th>
                <th>ìˆ˜ëŸ‰</th>
                <th>ë‹¨ìœ„</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="ing : ${ingrList}">
                <td><input type="text" id="ingrNames" name="ingrNames" th:value="${ing.ingrName}"    readonly class="input_style wd90"></td>
                <td><input type="text" id="ingrAmounts" name="ingrAmounts" th:value="${ing.ingrAmount}"  readonly   class="input_style wd90"></td>
                <td><input type="text" id="ingrUnits" name="ingrUnits" th:value="${ing.ingrUnit}"    readonly     class="input_style wd90"></td>
            </tr>
            </tbody>
        </table>

        <!-- ìš”ë¦¬ ë‹¨ê³„ -->
        <div id="stepContainer" class="step-container">
            <div class="step-row" th:each="step:${stepList}">
                <div class="step-image-area">
                    <img th:src="${step.stepImagePath}" class="step-preview" alt="ë¯¸ë¦¬ë³´ê¸°" />
                </div>
                <textarea id="stepDescriptions" name="stepDescriptions" th:text="${step.stepDescription}" readonly rows="6"></textarea>
            </div>
        </div>

        <label>ìš”ë¦¬ íŒ & ì£¼ì˜ì‚¬í•­ ğŸ’¡</label>
        <textarea id="recipeTips" name="recipeTips" th:text="${recipe.recipeTips}" readonly  rows="6"></textarea>

    </div>
</form>

    <script>
        // ì¬ë£Œ ì¶”ê°€/ì‚­ì œ
        function addIngredientRow() {
            const tbody = document.querySelector("#ingredientTable tbody");
            const row = document.createElement("tr");
            row.innerHTML = `
                <td><input type="text" name="ingredientNames" placeholder="ì˜ˆ) ì–‘íŒŒ"       class="input_style wd90"></td>
                <td><input type="text" name="ingredientAmounts" placeholder="ì˜ˆ) 1/2"     class="input_style wd90"></td>
                <td><input type="text" name="ingredientUnits" placeholder="ì˜ˆ) ê°œ"         class="input_style wd90"></td>
                <td><button type="button" class="remove-btn" onclick="removeRow(this)">ì‚­ì œ</button></td>
            `;
            tbody.appendChild(row);
        }


         // ìš”ë¦¬ ìˆœì„œ í–‰ ì¶”ê°€/ì‚­ì œ
        function addStepRow() {
            const container = document.getElementById("stepContainer");
            const row = document.createElement("div");
            row.className = "step-row";
            row.innerHTML = `
            <button type="button" class="remove-btn" onclick="removeRow(this)">ì‚­ì œ</button>
            <div class="step-image-area">
                <input type="file" name="stepImages" accept="image/*" onchange="previewStepImage(this)">
                <img class="step-preview" alt="ë¯¸ë¦¬ë³´ê¸°" />
            </div>
            <textarea name="stepDescriptions" placeholder="ì˜ˆ) ì–‘íŒŒë¥¼ ì±„ ì°ì–´ íŒ¬ì— ë³¶ëŠ”ë‹¤." rows="6"></textarea>
        `;
            container.appendChild(row);
        }

        function removeRow(button) {
            const row = button.closest("tr") || button.closest(".step-row");
            if (row) row.remove();
        }

        // Step ì´ë¯¸ì§€ ë¯¸ë¦¬ë³´ê¸°
        function previewStepImage(input) {
            const preview = input.closest(".step-image-area").querySelector(".step-preview");
            const file = input.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = e => preview.src = e.target.result;
                reader.readAsDataURL(file);
            }
        }
        // âœ… ì™„ì„± ì‚¬ì§„ ì—¬ëŸ¬ì¥ ë¯¸ë¦¬ë³´ê¸°
        function previewMultipleImages(event) {
            const files = event.target.files;
            const previewArea = document.getElementById("mainPreviewArea");
            previewArea.innerHTML = "";
            if (files.length > 0) {
                Array.from(files).forEach(file => {
                    const reader = new FileReader();
                    reader.onload = e => {
                        const img = document.createElement("img");
                        img.src = e.target.result;
                        img.classList.add("multi-preview-image");
                        previewArea.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                });
            } else {
                previewArea.innerHTML = "<span>ì´ë¯¸ì§€ë¥¼ ì„ íƒí•˜ë©´ ë¯¸ë¦¬ë³´ê¸° ë©ë‹ˆë‹¤</span>";
            }
        }
    </script>

</body>
</html>

